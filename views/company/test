<div class = "container-fluid">
        
        <div class = "row"> 
            <div class="col-md-2">
                <!-- label_tag(:Vrsta, "Vrsta:")-->
                <div>   
                    <select name = "tip" id="tipNaloga" onchange="Pronadji_brojeve_naloga()">
                        <!--  @tipoviNaloga.each do |x|-->
                            <!-- if x == "N"-->
                                <option selected="selected"></option> <!--value="#{x}"%>>"#{x}"%></option>
                             else-->
                                <!-- unless x == "R"-->
                                <option></option> <!--value="#{x}"%>>"#{x}"%></option>
                                end-->
                            <!-- end -->
                        <!-- end -->
                    </select>
                </div>
            </div>
            <div class="col-md-2">
            <!-- label_tag(:broj, "Broj:")-->     
                <div id="broj_naloga">
                    <select name= "broj_naloga" id="broj_naloga_select">
                        <!-- @brojevi.each do |x|-->
                            <option></option> <!--value="#{x}"%>>"#{x}"%></option>
                         end -->
                    </select>
                </div>
            </div>
            <div class="col-md-6"> 
                <div>
                      <!-- label_tag(:opis, "Opis naloga:")-->
                      <!-- text_field_tag(:opis, "" , :size => "80")-->
                </div>
            </div>
        </div>    
        
        <div class = "row new_nalog_datum_row"> 
            <div class="col-md-2">
                <div>  
                      <!-- label_tag(:datum, "Datum:")--></br>
                      <!-- date_field(:nalog, :datum, :size => "40", :value => Time.now.strftime('%Y-%m-%d'))-->
                </div>
            </div>
            <div class="col-md-2">
                
            </div>
            <div class="col-md-2">
                
            </div>
        </div>    
        
        <!--# prvi red-->
            
        <div class="grid-container new_nalog_stavovi_row">  
            
            <div class="grid-item">
                <!-- label_tag(:opis_stav, "Opis stava:")--></br>
                <!--# ovde multiple true ne radi, pa se mora dodati []-->
                <!--# label_tag(1, nil, class: "label")-->
                <!-- text_field_tag("opis_stav[]", "", :size => "35")-->
            </div>
            
            <div class="grid-item">
                <!-- label_tag(:sifra_komitenta, "Šifra k.")-->
                <select data-placeholder="Select..." class="chosen-select" name="sifre_komitenata[]">
                    <!-- @sifre.each do |x|-->
                        <option></option>
                        <option><!-- x[0]--> | <!-- x[1]--></option>
                    <!-- end-->
                </select>
            </div>
            
            <div class="grid-item">
                <!-- label_tag(:poziv, "Poziv:")-->
                <!-- search_field_tag('poziv[]', nil, class: "konto")-->
            </div>
            
            <div class="grid-item">
                <!-- label_tag(:konto, "Konto:")--> <i class="fa fa-plus-square dodaj_racun" style="display:inline-block;margin-top:5px;cursor: pointer;"></i> <div id="dijalog_za_konta" style="display: none;" ></div>       
                <!--# search_field_tag('konto[]', nil, class: "konto")-->
                <input type="text" list="konto[]" class="konto" size="15" oninput="skinitekst(this)" name="konto[]" autocomplete="off">
                <datalist id="konto[]">
                    <!-- @konta.each do |x|-->
                    <option></option> <!--value=" x[0] + " | " + x[1]-->">
                        <!-- end-->
                </datalist>
            </div>
            
            <div class="grid-item dugipot">
                <!-- label_tag(:duguje, "Duguje:")-->
                <!--# multiple true magija, za polja sa istim imenom-->
                <!-- number_field(:stav, :duguje, step: 0.01, multiple: true, :value => 0.0)-->
            </div>
            
            <div class="grid-item dugipot">
                <!-- label_tag(:potrazuje, "Potražuje:")-->
                <!-- number_field(:stav, :potrazuje, step: 0.01, multiple: true, :value => 0.0)-->
            </div>
            
            <div class="grid-item valuta">
                <!-- label_tag(:valuta, "Valuta:")-->
                <!-- date_field(:stav, :datum, :size => "20", multiple: true)-->
            </div>
            
            <div class="grid-item">
                <!--# <div class="dodaj_button" onclick="dodaj_red()">&plus;</div>-->
            </div>
        
        </div>
            
        <div class="row" id="crta-0" style="margin: 0px; padding: 0px">
            
            <hr class="nalog-hr"></hr>
            
        </div>
        
        <!--# drugi red-->
        
        <div class="grid-container">  
            
            <div class="grid-item">
                <!-- text_field_tag("opis_stav[]", "", :size => "35")-->
            </div>
            
            <div class="grid-item">
                <select data-placeholder="Select..." class="chosen-select" name="sifre_komitenata[]" id="za_kopiranje">
                    <option></option>
                    <!-- @sifre.each do |x|--> 
                        <option><!-- x[0]--> | <!-- x[1]--></option>
                    <!-- end-->
                </select>
            </div>
            
            <div class="grid-item">
                <!-- search_field_tag('poziv[]', nil, class: "konto")-->
            </div>
            
            <div class="grid-item">
                <input type="text" list="konto[]" class="konto" size="15" oninput="skinitekst(this)" name="konto[]" autocomplete="off">
                <!-- if false-->
                <datalist class="konto[]">
                    <!-- @konta.each do |x|-->
                    <option></option> <!--value=" x[0] + " | " + x[1]-->">
                        <!-- end-->
                </datalist>
                <!-- end-->
            </div>
            
            <div class="grid-item dugipot">
                <!-- number_field(:stav, :duguje, step: 0.01, multiple: true, :value => 0.0)-->. 
            </div>
            
            <div class="grid-item dugipot">
                <!-- number_field(:stav, :potrazuje, step: 0.01, multiple: true, :value => 0.0)-->
            </div>
            
            <div class="grid-item valuta">
                <!-- date_field(:stav, :datum, :size => "20", multiple: true)-->
            </div>
            
            <div class="grid-item">
                <div class="dodaj_button" onclick="izbrisi_red()">&minus;</div>
            </div>
        
        </div>
        
        
        <div class="row" id="crta-1" style="margin: 0px; padding: 0px">
            
            <hr class="nalog-hr"></hr>
            
        </div>
        
        <div class="grid-container samo_plus"> 
            <div class="grid-item samo_plus_item">
                
            </div>
            <div class="grid-item samo_plus_item">
                <div class="dodaj_button" onclick="dodaj_red()">&plus;</div>
            </div>
        </div>
        
        <!--# ovde treba ubaciti red-->
         
    </div>      

<!-- end-->

</div>

<div id = "zbirovi" class = "container-fluid" style="margin-top: 15px;">
    <div class = "row">
        <div class="col-md-6">
        </div>
        <div class="col-md-1">
            <p id="zbir_duguje" style="margin: auto; width: 50%; color:red;"></p>
        </div>
        <div class="col-md-1">
            <p id="razlika" style="margin: auto; width: 50%; color:red;"></p>
        </div>
        <div class="col-md-1">
            <p id="zbir_potrazuje" style="margin: auto; width: 50%; color:red;"></p>
        </div>
        <div class="col-md-3">
        </div>
    </div>
</div>


<script>
        function close_dialog(){
              var dialog_placeholder = document.getElementById("nalog_placeholder");
              dialog_placeholder.innerHTML='';
            }    
        
        $(document).ready(function() {
            $(".chosen-select").chosen({allow_single_deselect: true});
        });
        
        $(document).on('change', '.chosen-select', function(e, params) {
            
            var s = $(this).val();
            
            if (s.includes("|"))
                {
                var x = s.substring(0, s.indexOf('|')).trim();
                // mora se dodati vrednost u <options> da bi mogla biti selektovana
                $(this).append('<option value='+ x +'></option>');
                $(this).val(x).trigger("liszt:updated"); // sad ispadne da imam staru verziju chodena?!?!
                
                // ne radi mi triger:update pa moram ovako
                $(this).next().children(":first").children(":first").text(x);
                // da skinem crveni okvir ako je pre toga bio
                $(this).next().removeClass('sifra_komitenta_input_bez_sifre');
                }
            else {}
        });
        //    var comboplete = new Awesomplete('input.dropdown-input', {
        //	minChars: 0,
        //});
        //Awesomplete.$('.dropdown-btn').addEventListener("click", function() {
        //	if (comboplete.ul.childNodes.length === 0) {
        //		comboplete.minChars = 0;
        //		comboplete.evaluate();
        //	}
        //	else if (comboplete.ul.hasAttribute('hidden')) {
        //		comboplete.open();
        //	}
        //	else {
        //		comboplete.close();
        //	}
        //});
        //});
           
        
        function Pronadji_brojeve_naloga() {
                    
                    var tip = $("#tipNaloga").val()
                    console.log(tip)
                    
                    $.ajax({
                    url: "/pronadji_broj_naloga",
                    type: "POST",
                    data: { oznaka: tip},
                    dataType: "script"}
                    
                    );
                    
        }
        function dodaj_red() {
                    $.ajax({
                    url: "/dodaj_red_stava",
                    type: "GET",
                    data: { },
                    dataType: "script"}
                    );
                    
        }
        
        function izbrisi_red() {
                   var x = $(event.target).parent();//ovo je gri-item
                   var y = x.parent();
                   var z = y.next();
                   y.remove();
                   z.remove();
                   
                   $("div.dodaj_button").last().replaceWith('<div class="dodaj_button" onclick="dodaj_red()">&plus;</div>');
        
        }
        
        $("#nalog_dijalog").off('change','.dugipot').on('change','.dugipot', function() {
            
            var prvi = 0;
            var drugi = 0;
            $(".dugipot input").each(function(index) {
                if (index % 2 == 0) { prvi += parseFloat($(this).val()); }
                else { drugi += parseFloat($(this).val()); }
            });
            var razlika = (prvi - drugi).toFixed(2);
            if (prvi > drugi)
            {
             $( "#zbir_potrazuje" ).text( -razlika );
             $( "#zbir_duguje" ).text( "" );
            }
            else if (drugi > prvi)
            {
             $( "#zbir_duguje" ).text( razlika );
             $( "#zbir_potrazuje" ).text( "" );
            }
            else
            {
             $( "#zbir_potrazuje" ).text( "" );
             $( "#zbir_duguje" ).text( "" );
            }
            
            
        });
        
        
        function skinitekst(element) {
                    
                    // ovde je fora da mi ne puca stalno ova funkcija
                    // jer ako puca stalno, ne mogu da ukucavam ,samo mogu da selektujem
                    var s = element.value;
                    
                    if (s.includes("|"))
                    {
                        var x = s.substring(0, s.indexOf('|')).trim();
                        element.value = x;
                    }
                    else {}
                    
                    obelezi_polje_sifre(element, x);
                    
        }
        
        $("#nalog_dijalog").off('focusout','input.konto').on('focusout','input.konto', function() {
            
            obelezi_polje_sifre(this, this.value);
            
            
        });
        
        function obelezi_polje_sifre(element, broj){
            
            //var array = <!-- raw @zbirna_konta.to_json-->
            var sifra_komitenta_za_odabrani_konto = element.parentNode.parentNode.childNodes[3].childNodes[3];
            var za_promenu = sifra_komitenta_za_odabrani_konto.nextElementSibling;
            console.log(sifra_komitenta_za_odabrani_konto.value);
            
            if (array.includes(broj))
            {
                if (sifra_komitenta_za_odabrani_konto.value == "")
                    {
                        za_promenu.classList.add('sifra_komitenta_input_bez_sifre');
                    }
                    else {}
                    }
                else {}
        }
        
        
        //$(document).off('focusout', 'input#stav_duguje').on('focusout','input#stav_duguje', function(e) {
            //console.log("vlada");
        //    this.value = addSeparatorsNF(this.value, '.', ',','.')
        //});
        
        // function addSeparatorsNF(nStr, inD, outD, sep)
        // {
        // 	nStr += '';
        // 	var dpos = nStr.indexOf(inD);
        // 	var nStrEnd = '';
        // 	if (dpos != -1) {
        // 		nStrEnd = outD + nStr.substring(dpos + 1, nStr.length);
        // 		nStr = nStr.substring(0, dpos);
        // 	}
        // 	var rgx = /(\d+)(\d{3})/;
        // 	while (rgx.test(nStr)) {
        // 		nStr = nStr.replace(rgx, '$1' + sep + '$2');
        // 	}
        // 	return nStr + nStrEnd;
        //}
        ///////////////////////////////////////////////////////
        //EKSPERIMENTALNO
        
        jQuery.extend(jQuery.expr[':'], {
            focusable: function (el, index, selector) {
                return $(el).is('a, button, :input, [tabindex], input');
            }
        });
        
        $(document).off('keypress', 'input.select').on('keypress', 'input.select', function (e) {
            if (e.which == 13) {
                e.preventDefault();
                // Get all focusable elements on the page
                var $canfocus = $(':focusable');
                var index = $canfocus.index(document.activeElement) + 1;
                if (index >= $canfocus.length) index = 0;
                $canfocus.eq(index).focus();
            }
        });
        ///////////////////////////////////////////////////////
        
        
        $("#nalog_dijalog").off('keydown','.dugipot').on('keydown','.dugipot', function(e) {
            
            console.log(e.which);
               if (e.which != 110 ){//not a fullstop
                var n = parseFloat($(this).val().replace(/\,/g,''),10);
                $(this).val(n.toLocaleString());
            }
            
            
        });
        
        
        
        </script>
        


</div>


